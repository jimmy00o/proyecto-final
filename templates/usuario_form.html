{% extends 'baseadmin.html' %}

{% block title %}{{ 'Nuevo Usuario' if modo == 'crear' else 'Editar Usuario' }}{% endblock %}

{% block body %}
<div class="container mt-4" style="max-width: 720px;">

  <h2 class="mb-3">
    {{ 'Nuevo Usuario' if modo == 'crear' else 'Editar Usuario' }}
  </h2>

  <!-- ðŸ”¥ ALERTA ESTILO PRODUCTOS (SweetAlert2 Toast) -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <script>
          document.addEventListener('DOMContentLoaded', function() {
            const Toast = Swal.mixin({
              toast: true,
              position: 'top-end',
              showConfirmButton: false,
              timer: 2000,
              timerProgressBar: true,
              didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
              }
            });

            Toast.fire({
              icon: '{{ category }}',
              title: '{{ message }}'
            });
          });
        </script>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form method="post" class="card p-3 shadow-sm">

    <!-- Nombre -->
    <div class="mb-3">
      <label class="form-label fw-bold">Nombre</label>
      <input type="text" name="nombre" class="form-control"
             value="{{ usuario.nombre or '' }}" required
             data-bs-toggle="tooltip" title="Ejemplo: Carlos MartÃ­nez">
    </div>

    <!-- Correo -->
    <div class="mb-3">
      <label class="form-label fw-bold">Correo</label>
      <input type="email" name="email" class="form-control"
             value="{{ usuario.email or '' }}" required
             data-bs-toggle="tooltip" title="Ejemplo: usuario@empresa.com">
    </div>

    <!-- Password -->
    <div class="mb-3">
      <label class="form-label fw-bold">Password</label>
      <input type="text" name="password" class="form-control"
             value="{{ usuario.password or '' }}" required
             data-bs-toggle="tooltip" title="Debe contener mÃ­nimo 8 caracteres.">
    </div>

    <!-- Botones -->
    <div class="d-flex gap-2">
      <button class="btn btn-primary" type="submit">
        {{ 'Crear' if modo == 'crear' else 'Guardar Cambios' }}
      </button>

      <a class="btn btn-secondary" href="{{ url_for('lista_usuarios') }}">
        Cancelar
      </a>
    </div>

  </form>
</div>

<!-- Script para activar tooltips -->
<script>
  document.addEventListener('DOMContentLoaded', function () {

    const tooltipEls = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    const tooltipInstances = tooltipEls.map(el => new bootstrap.Tooltip(el));

    document.addEventListener('shown.bs.tooltip', function (event) {
      tooltipInstances.forEach(instance => {
        if (instance._element !== event.target) instance.hide();
      });
    });

    tooltipEls.forEach(el => {
      el.addEventListener('mouseleave', () => {
        const inst = bootstrap.Tooltip.getInstance(el);
        if (inst) inst.hide();
      });
    });

  });
</script>
{% endblock %}
