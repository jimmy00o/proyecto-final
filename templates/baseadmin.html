<!doctype html>
<html lang="es">
<head>
  <title>{% block title %}{% endblock title %}</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <!-- Bootstrap 5.3 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"/>

  <!-- SweetAlert2 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.23.0/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.23.0/dist/sweetalert2.all.min.js"></script>

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

  <!-- DataTables -->
  <link href="https://cdn.datatables.net/v/dt/dt-2.0.3/datatables.min.css" rel="stylesheet">

  <style>
    body { background: #c18c84; min-height: 100vh; }
    .navbar {
      background: linear-gradient(90deg, #7c3aed, #ff1f8f, #ff7a00);
      background-size: 200% 200%;
      animation: gradientShift 12s ease infinite;
      box-shadow: 0 6px 20px rgba(0,0,0,.4);
    }
    @keyframes gradientShift { 0% { background-position:0% 50%; } 50% { background-position:100% 50%; } 100% { background-position:0% 50%; } }
    .navbar .navbar-brand { font-weight: bold; color: #fff; text-shadow:0 0 10px rgba(255,255,255,0.7);}
    .navbar .nav-link { color: #f3f4f6 !important; font-weight: 600; position: relative; }
    .navbar .nav-link:hover { text-decoration: underline; text-shadow:0 0 6px rgba(255,255,255,0.8);}

    .btn-outline-success { border-color: #fff; color: #fff; text-shadow:0 0 4px rgba(255,255,255,0.6);}
    .btn-outline-success:hover { background:#fff;color:#111;}

    .user-chip { background: rgba(255,255,255,.15); padding: .4rem .9rem; border-radius: 999px; font-weight:bold; color:#fff; text-shadow:0 0 5px rgba(255,255,255,.5);}

    .card-perfil { background: linear-gradient(135deg, #198754, #d1e7dd); color: #fff; }
    .card-registrar { background: linear-gradient(135deg, #0d6efd, #cfe2ff); color: #fff; }
    .card-visualizar { background: linear-gradient(135deg, #6f42c1, #e0cffc); color: #fff; }

    .card { border:none; border-radius:14px; box-shadow:0 6px 15px rgba(0,0,0,.2); transition: transform 0.2s ease, box-shadow 0.2s ease;}
    .card:hover { transform: scale(1.03); box-shadow:0 8px 20px rgba(0,0,0,.3);}
    .card h5 { font-weight:bold; }

    footer { background:#ff7a00; color:#fff; text-shadow:0 0 5px rgba(255,255,255,.5);}

    .tooltip-inner { background-color:#343a40 !important; color:#fff !important; font-weight:500; font-size:.875rem;}
  </style>
</head>

<body>
<header>
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand text-white" href="{{ url_for('admin') }}" data-bs-toggle="tooltip" title="Ir al inicio">
        <i class="bi bi-lightning-charge-fill"></i> Sistema
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
              aria-expanded="false" aria-label="Toggle navigation" data-bs-toggle="tooltip" title="Mostrar menÃº">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav justify-content-center flex-grow-1">
          <li class="nav-item"><a class="nav-link" href="{{ url_for('admin') }}" data-bs-toggle="tooltip" title="PÃ¡gina principal">Inicio</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" title="Opciones de productos">Productos</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="{{ url_for('listar_productos_agregados') }}" title="Agregar un nuevo producto">Agregar</a></li>
              <li><a class="dropdown-item" href="{{ url_for('productos_listar') }}" title="Listar todos los productos">Listar</a></li>
            </ul>
          </li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('perfil_admin') }}" data-bs-toggle="tooltip" title="Ver perfil de administrador">Perfil</a></li>
        </ul>

        {% set nombre = session.get('nombre') %}
        <span class="user-chip me-3" title="Usuario activo">
          <i class="bi bi-person-circle me-1"></i>
          {{ nombre if nombre else 'Usuario #' ~ session.get('id', '') }}
        </span>
        <a class="btn btn-outline-success" href="{{ url_for('logout') }}" title="Cerrar sesiÃ³n">SALIR</a>
      </div>
    </div>
  </nav>
</header>

<main class="container py-4">

  <!-- ðŸ”™ BOTÃ“N SOLO SI NO ESTAMOS EN EL PANEL PRINCIPAL -->
  {% if request.endpoint != 'admin' %}
    <button onclick="history.back()" class="btn btn-dark mb-3">
      <i class="bi bi-arrow-left-circle me-1"></i> Retroceder
    </button>
  {% endif %}

  {% block body %}{% endblock %}
</main>

<footer class="text-center py-3 mt-4" title="Gracias por usar Sistema">
  <p class="mb-0">Â© 2025 â€” UNAN Managua</p>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.datatables.net/v/dt/dt-2.0.3/datatables.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {

  const tooltipEls = Array.from(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  const tooltipInstances = tooltipEls.map(el => new bootstrap.Tooltip(el));

  document.addEventListener('shown.bs.tooltip', function (e) {
    tooltipInstances.forEach(t => { if (t._element !== e.target) t.hide(); });
  });

  const logoutBtn = document.querySelector('a[href="{{ url_for("logout") }}"]');
  if (logoutBtn) {
    logoutBtn.addEventListener('click', function(e) {
      e.preventDefault();
      Swal.fire({
        title: 'Â¿Seguro que deseas cerrar sesiÃ³n?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'SÃ­',
        cancelButtonText: 'Cancelar',
        background: '#fff',
        color: '#000'
      }).then(result => { if(result.isConfirmed) window.location.href = logoutBtn.href; });
    });
  }

  document.querySelectorAll('.eliminar-form').forEach(form => {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const btn = form.querySelector('button[type="submit"]');
      const nombre = btn.dataset.nombre || 'este elemento';

      Swal.fire({
        title: `Â¿Eliminar "${nombre}"?`,
        text: "Â¡Esta acciÃ³n no se puede deshacer!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'SÃ­, eliminar',
        cancelButtonText: 'Cancelar',
      }).then(result => { if(result.isConfirmed) form.submit(); });
    });
  });
});
</script>
</body>
</html>
