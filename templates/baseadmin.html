<!doctype html>
<html lang="es">
<head>
  <title>{% block title %}{% endblock title %}</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <!-- Bootstrap 5.3 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"/>

  <!-- SweetAlert2 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.23.0/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.23.0/dist/sweetalert2.all.min.js"></script>

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

  <!-- DataTables -->
  <link href="https://cdn.datatables.net/v/dt/dt-2.0.3/datatables.min.css" rel="stylesheet">

  <style>
    body {
      background: #c18c84; /* Fondo piel mÃ¡s oscuro */
      min-height: 100vh;
    }

    /* Navbar degradado animado */
    .navbar {
      background: linear-gradient(90deg, #7c3aed, #ff1f8f, #ff7a00);
      background-size: 200% 200%;
      animation: gradientShift 12s ease infinite;
      box-shadow: 0 6px 20px rgba(0,0,0,.4);
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .navbar .navbar-brand {
      font-weight: bold;
      color: #fff;
      text-shadow: 0 0 10px rgba(255,255,255,0.7);
    }
    .navbar .nav-link {
      color: #f3f4f6 !important;
      font-weight: 600;
      position: relative;
    }
    .navbar .nav-link:hover {
      text-decoration: underline;
      text-shadow: 0 0 6px rgba(255,255,255,0.8);
    }

    /* BotÃ³n salir */
    .btn-outline-success {
      border-color: #fff;
      color: #fff;
      text-shadow: 0 0 4px rgba(255,255,255,0.6);
    }
    .btn-outline-success:hover {
      background: #fff;
      color: #111;
    }

    /* Usuario */
    .user-chip {
      background: rgba(255,255,255,.15);
      padding: .4rem .9rem;
      border-radius: 999px;
      font-weight: bold;
      color: #fff;
      text-shadow: 0 0 5px rgba(255,255,255,0.5);
    }

    /* Tarjetas de colores */
    .card-perfil { background: linear-gradient(135deg, #198754, #d1e7dd); color: #fff; }
    .card-registrar { background: linear-gradient(135deg, #0d6efd, #cfe2ff); color: #fff; }
    .card-visualizar { background: linear-gradient(135deg, #6f42c1, #e0cffc); color: #fff; }

    .card {
      border: none;
      border-radius: 14px;
      box-shadow: 0 6px 15px rgba(0,0,0,.2);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .card:hover {
      transform: scale(1.03);
      box-shadow: 0 8px 20px rgba(0,0,0,.3);
    }
    .card h5 { font-weight: bold; }

    /* Botones segÃºn tarjeta */
    .card-perfil .btn { background-color: #198754 !important; color: #fff !important; }
    .card-registrar .btn { background-color: #0d6efd !important; color: #fff !important; }
    .card-visualizar .btn { background-color: #6f42c1 !important; color: #fff !important; }

    /* Footer */
    footer {
      background: #ff7a00;
      color: #fff;
      text-shadow: 0 0 5px rgba(255,255,255,0.5);
    }

    /* Cambiar color de tooltip */
    .tooltip-inner {
      background-color: #343a40 !important; /* Fondo oscuro */
      color: #fff !important; /* Texto blanco */
      font-weight: 500;
      font-size: 0.875rem;
    }
    .tooltip.bs-tooltip-auto[x-placement^=top] .arrow::before,
    .tooltip.bs-tooltip-top .arrow::before {
      border-top-color: #343a40 !important;
    }
    .tooltip.bs-tooltip-auto[x-placement^=bottom] .arrow::before,
    .tooltip.bs-tooltip-bottom .arrow::before {
      border-bottom-color: #343a40 !important;
    }
    .tooltip.bs-tooltip-auto[x-placement^=left] .arrow::before,
    .tooltip.bs-tooltip-left .arrow::before {
      border-left-color: #343a40 !important;
    }
    .tooltip.bs-tooltip-auto[x-placement^=right] .arrow::before,
    .tooltip.bs-tooltip-right .arrow::before {
      border-right-color: #343a40 !important;
    }
  </style>
</head>

<body>
<header>
  <!-- ðŸ”» AQUÃ se quitÃ³ SOLO el tooltip del nav (antes tenÃ­a data-bs-toggle, data-bs-placement y title) -->
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand text-white" href="{{ url_for('admin') }}" data-bs-toggle="tooltip" title="Ir al inicio">
        <i class="bi bi-lightning-charge-fill"></i> Sistema
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
              aria-expanded="false" aria-label="Toggle navigation" data-bs-toggle="tooltip" title="Mostrar menÃº">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav justify-content-center flex-grow-1">
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('admin') }}" data-bs-toggle="tooltip" title="PÃ¡gina principal">Inicio</a>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" title="Opciones de productos">
              Productos
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="{{ url_for('listar_productos_agregados') }}" data-bs-toggle="tooltip" title="Agregar un nuevo producto">Agregar</a></li>
              <li><a class="dropdown-item" href="{{ url_for('productos_listar') }}" data-bs-toggle="tooltip" title="Listar todos los productos">Listar</a></li>
            </ul>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('perfil_admin') }}" data-bs-toggle="tooltip" title="Ver perfil de administrador">Perfil</a>
          </li>
        </ul>

        {% set nombre = session.get('nombre') %}
        <span class="user-chip me-3" data-bs-toggle="tooltip" title="Usuario activo">
          <i class="bi bi-person-circle me-1"></i>
          {{ nombre if nombre else 'Usuario #' ~ session.get('id', '') }}
        </span>
        <a class="btn btn-outline-success" href="{{ url_for('logout') }}" data-bs-toggle="tooltip" title="Cerrar sesiÃ³n">SALIR</a>
      </div>
    </div>
  </nav>
</header>

<main class="container py-4">
  {% block body %}{% endblock %}
</main>

<footer class="text-center py-3 mt-4" data-bs-toggle="tooltip" title="Gracias por usar Sistema">
  <p class="mb-0">Â© 2025 â€” UNAN Managua</p>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.datatables.net/v/dt/dt-2.0.3/datatables.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Inicializar tooltips
    const tooltipEls = Array.from(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    const tooltipInstances = tooltipEls.map(el => new bootstrap.Tooltip(el));

    // âœ… Asegurar que solo haya UN tooltip visible a la vez
    // 1) Cuando se muestra uno, ocultamos todos los demÃ¡s
    document.addEventListener('shown.bs.tooltip', function (e) {
      tooltipInstances.forEach(t => {
        if (t._element !== e.target) t.hide();
      });
    });

    // 2) TambiÃ©n al pasar el mouse, ocultamos los demÃ¡s por si quedaron visibles
    tooltipEls.forEach((el) => {
      el.addEventListener('mouseenter', () => {
        tooltipInstances.forEach(t => {
          if (t._element !== el) t.hide();
        });
      });
      // Oculta al salir para evitar que quede pegado si se mueve rÃ¡pido
      el.addEventListener('mouseleave', () => {
        const inst = bootstrap.Tooltip.getInstance(el);
        if (inst) inst.hide();
      });
      // Accesibilidad: con foco/blur (teclado)
      el.addEventListener('focus', () => {
        tooltipInstances.forEach(t => {
          if (t._element !== el) t.hide();
        });
      }, true);
      el.addEventListener('blur', () => {
        const inst = bootstrap.Tooltip.getInstance(el);
        if (inst) inst.hide();
      }, true);
    });

    // ConfirmaciÃ³n de logout (se mantiene igual)
    const logoutBtn = document.querySelector('a[href="{{ url_for("logout") }}"]');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', function (e) {
        e.preventDefault();
        Swal.fire({
          title: 'Â¿Seguro que deseas cerrar sesiÃ³n?',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'SÃ­',
          cancelButtonText: 'Cancelar',
          background: '#fff',
          color: '#000'
        }).then((result) => {
          if (result.isConfirmed) window.location.href = logoutBtn.href;
        });
      });
    }
  });
</script>
</body>
</html>
